# Tidying code and creating a node module

Of late I haven't really done all that much in terms of adding features to my project. Between writing tests (117 total now!) and refactoring code I've not had much opportunity to do so! I hope to change that this week now that all logic bar what is used to format for display and the lacklustre map generator is thoroughly covered by tests!

Getting everything covered by tests was something of a challenge initially due to the way the code was (poorly) structured. Following David's advice, I broke all my user input logic out of the React components and turned it into an action creator. [As you can see](https://github.com/MoombaDS/quest/commit/b44ebb4edc0e8c0af4b26465b4625081f9f8e1c0), it was a pretty big change for the better, allowing for far easier extendibility in the future and making the code far more open to unit testing.

As part of my roadmap for future testing, I also went ahead and moved all message creation responsibilities to `messagegen.js` which will allow me to more easily test the results of the action creators without having to hardcode any messages for the `expect` statements. I will, however, need to do some more testing of the messages themselves - particularly those that generate random responses.

A portion of testing elements with randomness requires me to stub the random generator. For this to work smoothly and painlessly, I had always planned to make use of [Sinon](http://sinonjs.org/), a nicely flexible module for stubs, mocks, and spies. Unfortunately, Sinon has some [issues](https://github.com/webpack/webpack/issues/304) with Webpack which meant quite a bit of jumping through hoops before getting anything to work. Thankfully the 2.0 pre-release version of Sinon seems to work properly with Webpack!

While researching localStorage and Redux a while back, I came up with my own implementation that would use custom middleware to save the state with each change and would use the saved state in place of initial state on application start. Apparently, the desire to use local storage is not completely uncommon and many search for a very simple way to implement it - much as I have done. Of course, there is `redux-localstorage` but I felt like the module heavily overcomplicated some of its aspects compared to the simplistic nature of what I needed. For that reason, I modified my implementation a little and published it to npm as [`redux-simple-localstorage`](https://www.npmjs.com/package/redux-simple-localstorage)! You can probably tell I'm new at this and the module is not exactly an amazing addition to anyone's projects, but it seemed like a fun thing to do at the time!

To close this blog post, I want to mention a little of what I plan to do with my project going forwards - or rather, what I plan to implement this coming week. My primary focus will be to get a simple combat system into the game - it probably won't properly reflect my vision for the final product, but it should allow for the basic aspects including hostile encounters and attacking friendly NPCs. With this will naturally come game over conditions and a level up/stat growth system, as well as potentially enemy scaling and so on. Stay tuned if you want to see how it turns out!
